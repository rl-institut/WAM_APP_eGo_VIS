<!DOCTYPE html>
{% load leaflet_tags %}
{% load static %}

<html lang="en">
<head>


    <link rel="stylesheet" type="text/css" href="{% static 'WAM_APP_eGo_VIS/css/map_size.css' %}">

    {% leaflet_js %}
    {% leaflet_css %}


    <!--<script type="text/javascript">-->
    <!--function map_init_basic (map, options) {-->
        <!--L.marker([50.5, 30.5]).addTo(map);-->
    <!--}-->
    <!--</script>-->


    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
        {% leaflet_map "map" callback="window.map_init_basic" %}
        {% block content %}
        {% endblock %}

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script type="text/javascript">
            function map_init_basic (map, options) {
                var popup = L.popup()

                var lines_dataurl = "{% url 'app_eGoVIS:Lines'|add:'.data' %}"
                var lvbranchtee_dataurl = "{% url 'app_eGoVIS:LvBranchtee'|add:'.data' %}"
                var lvgenerator_dataurl = "{% url 'app_eGoVIS:LvGenerator'|add:'.data' %}"
                var lvgrid_dataurl = "{% url 'app_eGoVIS:LvGrid'|add:'.data' %}"
                var lvloadarea_dataurl = "{% url 'app_eGoVIS:LvLoadarea'|add:'.data' %}"
                var lvstation_dataurl = "{% url 'app_eGoVIS:LvStation'|add:'.data' %}"

                var biomassIcon = L.icon({
                    iconUrl: "{% static 'WAM_APP_eGo_VIS/Icons/Pin_biomass_color_v2.svg' %}",
                    iconSize:     [38, 95], // size of the icon
                    iconAnchor:   [19, 72], // point of the icon which will correspond to marker's location
                    popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
                });

                var hydroIcon = L.icon({
                    iconUrl: "{% static 'WAM_APP_eGo_VIS/Icons/Pin_hydropower_color_v2.svg' %}",
                    iconSize:     [36, 44], // size of the icon
                    iconAnchor:   [18, 44], // point of the icon which will correspond to marker's location
                    popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
                });

                L.marker([53.4554, 9.6211], {icon: biomassIcon}).addTo(map);

                var mvbranchtee_dataurl = "{% url 'app_eGoVIS:MvBranchtee'|add:'.data' %}"
                var mvcircuitbreaker_dataurl = "{% url 'app_eGoVIS:MvCircuitbreaker'|add:'.data' %}"
                var mvgenerator_dataurl = "{% url 'app_eGoVIS:MvGenerator'|add:'.data' %}"
                var mvgrid_dataurl = "{% url 'app_eGoVIS:MvGrid'|add:'.data' %}"
                var mvload_dataurl = "{% url 'app_eGoVIS:MvLoad'|add:'.data' %}"
                var mvstation_dataurl = "{% url 'app_eGoVIS:MvStation'|add:'.data' %}"
                var hvmvtransformer_dataurl = "{% url 'app_eGoVIS:HvmvTransformer'|add:'.data' %}"
                var mvlvtransformer_dataurl = "{% url 'app_eGoVIS:MvlvTransformer'|add:'.data' %}"

                var dataurl_array = [lines_dataurl, lvbranchtee_dataurl, lvgenerator_dataurl, lvgrid_dataurl, lvloadarea_dataurl,
                                    lvstation_dataurl, mvbranchtee_dataurl, mvcircuitbreaker_dataurl, mvgenerator_dataurl,
                                    mvgrid_dataurl, mvload_dataurl, mvstation_dataurl, hvmvtransformer_dataurl,
                                    mvlvtransformer_dataurl];
                var arr_length = dataurl_array.length;
                var i;

                for (i = 0; i < arr_length; i++) {

                // Load GeoJsons via Ajax and add layers to map
                $.ajax({

                    url: dataurl_array[i],
                    dataType: 'json',
                    async: true,
                    success: function(geofeature){

                        function onEachFeature(geofeature, layer) {
                            // does this feature have a property named popupContent?
                            if (geofeature.properties) {
                                layer.bindPopup(geofeature.properties.name);
                            }
                        }

                        /*
                        // Add GeoJSON layer
                        var feature_prop =  geofeature['properties']
                        var layer = new L.geoJson(geofeature, {
                                          onEachFeature: onEachFeature});
                        map.addLayer(layer);
                        */

                        var layer = new L.geoJSON(geofeature, {
                            onEachFeature: onEachFeature,
                            pointToLayer: function (feature, latlng) {
                                if (feature.id < 20) {
                                    return L.marker(latlng, {icon: hydroIcon});
                                }
                                return L.marker(latlng, {icon: biomassIcon});
                            }
                            
                        })
                        map.addLayer(layer)

                        }

                });
                }
            }

        </script>

</body>

</html>
