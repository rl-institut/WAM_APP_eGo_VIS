<!DOCTYPE html>
{% load leaflet_tags %}
{% load static %}

<html lang="en">
<head>


    <link rel="stylesheet" type="text/css" href="{% static 'WAM_APP_eGo_VIS/css/map_size.css' %}">

    {% leaflet_js %}
    {% leaflet_css %}


    <!--<script type="text/javascript">-->
    <!--function map_init_basic (map, options) {-->
        <!--L.marker([50.5, 30.5]).addTo(map);-->
    <!--}-->
    <!--</script>-->


    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
        {% leaflet_map "map" callback="window.map_init_basic" %}
        {% block content %}
        {% endblock %}

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script type="text/javascript">
            function map_init_basic (map, options) {
                var popup = L.popup()

                var dataurl = "{% url 'app_eGoVIS:LvStation'|add:'.data' %}"

                var biomassIcon = L.icon({
                    iconUrl: "{% static 'WAM_APP_eGo_VIS/Icons/Pin_biomass_color_v2.svg' %}",
                    iconSize:     [38, 95], // size of the icon
                    iconAnchor:   [19, 72], // point of the icon which will correspond to marker's location
                    popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
                });

                var hydroIcon = L.icon({
                    iconUrl: "{% static 'WAM_APP_eGo_VIS/Icons/Pin_hydropower_color_v2.svg' %}",
                    iconSize:     [36, 44], // size of the icon
                    iconAnchor:   [18, 44], // point of the icon which will correspond to marker's location
                    popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
                });

                L.marker([53.4554, 9.6211], {icon: biomassIcon}).addTo(map);



                // Load GeoJsons via Ajax and add layers to map
                $.ajax({
                    url: dataurl,
                    dataType: 'json',
                    async: true,
                    success: function(geofeature){

                        function onEachFeature(geofeature, layer) {
                            // does this feature have a property named popupContent?
                            if (geofeature.properties) {
                                layer.bindPopup(geofeature.properties.name);
                            }
                        }

                        /*
                        // Add GeoJSON layer
                        var feature_prop =  geofeature['properties']
                        var layer = new L.geoJson(geofeature, {
                                          onEachFeature: onEachFeature});
                        map.addLayer(layer);
                        */

                        var layer = new L.geoJSON(geofeature, {
                            onEachFeature: onEachFeature,
                            pointToLayer: function (feature, latlng) {
                                if (feature.id < 20) {
                                    return L.marker(latlng, {icon: hydroIcon});
                                }
                                return L.marker(latlng, {icon: biomassIcon});
                            }
                            
                        })
                        map.addLayer(layer)

                        }

                     });
                }

        </script>

</body>

</html>
